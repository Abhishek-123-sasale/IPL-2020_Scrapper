{"version":3,"sources":["../../source/write/styles.js"],"names":["FORMAT_ID_STARTS_FROM","initStyles","fontFamily","fontSize","customFont","undefined","formats","formatsIndex","styles","stylesIndex","fonts","fontsIndex","fills","fillsIndex","borders","bordersIndex","push","size","family","left","right","top","bottom","gray125","getStyle","fontWeight","align","alignVertical","format","wrap","color","backgroundColor","borderColor","borderStyle","leftBorderColor","leftBorderStyle","rightBorderColor","rightBorderStyle","topBorderColor","topBorderStyle","bottomBorderColor","bottomBorderStyle","border","fontKey","fillKey","borderKey","key","styleId","formatId","String","length","fontId","weight","fillId","borderId","style","getStylesXml","generateXml","xml","i","font","getColor","fill","getBorderXml","direction","hasChildren","cellStyle","filter","_","join","Error","slice","toUpperCase"],"mappings":"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","sourcesContent":["// There seem to be about 100 \"built-in\" formats in Excel.\r\n// https://docs.microsoft.com/en-us/previous-versions/office/developer/office-2010/ee857658(v=office.14)?redirectedfrom=MSDN\r\nconst FORMAT_ID_STARTS_FROM = 100\r\n\r\nexport default function initStyles({\r\n  fontFamily,\r\n  fontSize\r\n}) {\r\n  const customFont = fontFamily || fontSize\r\n\r\n  if (fontFamily === undefined) {\r\n    fontFamily = 'Calibri'\r\n  }\r\n\r\n  if (fontSize === undefined) {\r\n    fontSize = 12\r\n  }\r\n\r\n  const formats = []\r\n  const formatsIndex = {}\r\n\r\n  const styles = []\r\n  const stylesIndex = {}\r\n\r\n  const fonts = []\r\n  const fontsIndex = {}\r\n\r\n  const fills = []\r\n  const fillsIndex = {}\r\n\r\n  const borders = []\r\n  const bordersIndex = {}\r\n\r\n  // Default font.\r\n  fonts.push({\r\n    size: fontSize,\r\n    family: fontFamily\r\n  })\r\n  fontsIndex['-:-'] = 0\r\n\r\n  // Default fill.\r\n  fills.push({})\r\n  fillsIndex['-'] = 0\r\n\r\n  // Default border.\r\n  borders.push({\r\n    left: {},\r\n    right: {},\r\n    top: {},\r\n    bottom: {}\r\n  })\r\n  bordersIndex['-:-/-:-/-:-/-:-'] = 0\r\n\r\n  // \"gray125\" fill.\r\n  // For some weird reason, MS Office 2007 Excel seems to require that to be present.\r\n  // Otherwise, if absent, it would replace the first `backgroundColor`.\r\n  fills.push({\r\n    gray125: true\r\n  })\r\n\r\n  function getStyle(\r\n    fontWeight,\r\n    align,\r\n    alignVertical,\r\n    format,\r\n    wrap,\r\n    color,\r\n    backgroundColor,\r\n    borderColor,\r\n    borderStyle,\r\n    leftBorderColor,\r\n    leftBorderStyle,\r\n    rightBorderColor,\r\n    rightBorderStyle,\r\n    topBorderColor,\r\n    topBorderStyle,\r\n    bottomBorderColor,\r\n    bottomBorderStyle,\r\n  ) {\r\n    // Custom borders aren't supported.\r\n    const border = undefined\r\n    // Look for an existing style.\r\n    const fontKey = `${fontWeight || '-'}:${color || '-'}`\r\n    const fillKey = backgroundColor || '-'\r\n    const borderKey =\r\n      `${(topBorderColor || borderColor) || '-'}:${(topBorderStyle || borderStyle) || '-'}` +\r\n      '/' +\r\n      `${(rightBorderColor || borderColor) || '-'}:${(rightBorderStyle || borderStyle) || '-'}` +\r\n      '/' +\r\n      `${(bottomBorderColor || borderColor) || '-'}:${(bottomBorderStyle || borderStyle) || '-'}` +\r\n      '/' +\r\n      `${(leftBorderColor || borderColor) || '-'}:${(leftBorderStyle || borderStyle) || '-'}`\r\n    const key = `${align || '-'}/${alignVertical || '-'}/${format || '-'}/${wrap || '-'}/${fontKey}/${fillKey}/${borderKey}`\r\n    const styleId = stylesIndex[key]\r\n    if (styleId !== undefined) {\r\n      return styleId\r\n    }\r\n    // Create new style.\r\n    // Get format ID.\r\n    let formatId\r\n    if (format) {\r\n      formatId = formatsIndex[format]\r\n      if (formatId === undefined) {\r\n        formatId = formatsIndex[format] = String(FORMAT_ID_STARTS_FROM + formats.length)\r\n        formats.push(format)\r\n      }\r\n    }\r\n    // Get font ID.\r\n    let fontId = customFont ? 0 : undefined\r\n    if (fontWeight || color) {\r\n      fontId = fontsIndex[fontKey]\r\n      if (fontId === undefined) {\r\n        fontId = fontsIndex[fontKey] = String(fonts.length)\r\n        fonts.push({\r\n          size: fontSize,\r\n          family: fontFamily,\r\n          weight: fontWeight,\r\n          color\r\n        })\r\n      }\r\n    }\r\n    // Get fill ID.\r\n    let fillId\r\n    if (backgroundColor) {\r\n      fillId = fillsIndex[fillKey]\r\n      if (fillId === undefined) {\r\n        fillId = fillsIndex[fillKey] = String(fills.length)\r\n        fills.push({\r\n          color: backgroundColor\r\n        })\r\n      }\r\n    }\r\n    // Get border ID.\r\n    let borderId\r\n    if (\r\n      borderColor ||\r\n      borderStyle ||\r\n      leftBorderColor ||\r\n      leftBorderStyle ||\r\n      rightBorderColor ||\r\n      rightBorderStyle ||\r\n      topBorderColor ||\r\n      topBorderStyle ||\r\n      bottomBorderColor ||\r\n      bottomBorderStyle\r\n    ) {\r\n      borderId = bordersIndex[borderKey]\r\n      if (borderId === undefined) {\r\n        borderId = bordersIndex[borderKey] = String(borders.length)\r\n        borders.push({\r\n          left: {\r\n            style: leftBorderStyle || borderStyle,\r\n            color: leftBorderColor || borderColor\r\n          },\r\n          right: {\r\n            style: rightBorderStyle || borderStyle,\r\n            color: rightBorderColor || borderColor\r\n          },\r\n          top: {\r\n            style: topBorderStyle || borderStyle,\r\n            color: topBorderColor || borderColor\r\n          },\r\n          bottom: {\r\n            style: bottomBorderStyle || borderStyle,\r\n            color: bottomBorderColor || borderColor\r\n          }\r\n        })\r\n      }\r\n    }\r\n    // Add a style.\r\n    styles.push({\r\n      fontId,\r\n      fillId,\r\n      borderId,\r\n      align,\r\n      alignVertical,\r\n      wrap,\r\n      formatId\r\n    })\r\n    return stylesIndex[key] = String(styles.length - 1)\r\n  }\r\n\r\n  // Add the default style.\r\n  getStyle()\r\n\r\n  return {\r\n    getStylesXml() {\r\n      return generateXml({ formats, styles, fonts, fills, borders })\r\n    },\r\n    getStyle\r\n  }\r\n}\r\n\r\nfunction generateXml({ formats, styles, fonts, fills, borders }) {\r\n  let xml = '<?xml version=\"1.0\" ?>'\r\n  xml += '<styleSheet xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">'\r\n\r\n  // Turns out, as weird as it sounds, the order of XML elements matters to MS Office Excel.\r\n  // https://social.msdn.microsoft.com/Forums/office/en-US/cc47ab65-dab7-4e32-b676-b641aa1e1411/how-to-validate-the-xlsx-that-i-generate?forum=oxmlsdk\r\n  // For example, previously this library was inserting `<cellXfs/>` before `<fonts/>`\r\n  // and that caused MS Office 2007 Excel to throw an error about the file being corrupt:\r\n  // \"Excel found unreadable content in '*.xlsx'. Do you want to recover the contents of this workbook?\"\r\n  // \"Excel was able to open the file by repairing or removing the unreadable content.\"\r\n  // \"Removed Part: /xl/styles.xml part with XML error.  (Styles) Load error. Line 1, column ...\"\r\n  // \"Repaired Records: Cell information from /xl/worksheets/sheet1.xml part\"\r\n\r\n  if (formats.length > 0) {\r\n    xml += `<numFmts count=\"${formats.length}\">`\r\n    for (let i = 0; i < formats.length; i++) {\r\n      xml += `<numFmt numFmtId=\"${FORMAT_ID_STARTS_FROM + i}\" formatCode=\"${formats[i]}\"/>`\r\n    }\r\n    xml += `</numFmts>`\r\n  }\r\n\r\n  xml += `<fonts count=\"${fonts.length}\">`\r\n  for (const font of fonts) {\r\n    const {\r\n      size,\r\n      family,\r\n      color,\r\n      weight\r\n    } = font\r\n    xml += '<font>'\r\n    xml += `<sz val=\"${size}\"/>`\r\n    xml += `<color ${color ? 'rgb=\"' + getColor(color) + '\"' : 'theme=\"1\"'}/>`\r\n    xml += `<name val=\"${family}\"/>`\r\n    // It's not clear what the `<family/>` tag means or does.\r\n    // It seems to always be `<family val=\"2\"/>` even for different\r\n    // font families (Calibri, Arial, etc).\r\n    xml += '<family val=\"2\"/>'\r\n    // It's not clear what the `<scheme/>` tag means or does.\r\n    xml += '<scheme val=\"minor\"/>'\r\n    if (weight === 'bold') {\r\n      xml += '<b/>'\r\n    }\r\n    xml += '</font>'\r\n  }\r\n  xml += '</fonts>'\r\n\r\n  // MS Office 2007 Excel seems to require a `<fills/>` element to exist.\r\n  // without it, MS Office 2007 Excel thinks that the file is broken.\r\n  xml += `<fills count=\"${fills.length}\">`\r\n  for (const fill of fills) {\r\n    const { color, gray125 } = fill\r\n    xml += '<fill>'\r\n    if (color) {\r\n      xml += '<patternFill patternType=\"solid\">'\r\n      xml += `<fgColor rgb=\"${getColor(color)}\"/>`\r\n      // Whatever that could mean.\r\n      xml += '<bgColor indexed=\"64\"/>'\r\n      xml += '</patternFill>'\r\n    } else if (gray125) {\r\n      // \"gray125\" fill.\r\n      // For some weird reason, MS Office 2007 Excel seems to require that to be present.\r\n      // Otherwise, if absent, it would replace the first `backgroundColor`.\r\n      xml += '<patternFill patternType=\"gray125\"/>'\r\n    } else {\r\n      xml += '<patternFill patternType=\"none\"/>'\r\n    }\r\n    xml += '</fill>'\r\n  }\r\n  xml += '</fills>'\r\n\r\n  // MS Office 2007 Excel seems to require a `<borders/>` element to exist:\r\n  // without it, MS Office 2007 Excel thinks that the file is broken.\r\n  xml += `<borders count=\"${borders.length}\">`\r\n  for (const border of borders) {\r\n    const {\r\n      left,\r\n      right,\r\n      top,\r\n      bottom\r\n    } = border\r\n    const getBorderXml = (direction, { style, color }) => {\r\n      if (color && !style) {\r\n        style = 'thin'\r\n      }\r\n      const hasChildren = color ? true : false\r\n      return `<${direction}` +\r\n        (style ? ` style=\"${style}\"` : '') +\r\n        (hasChildren ? '>' : '/>') +\r\n        (color ? `<color rgb=\"${getColor(color)}\"/>` : '') +\r\n        (hasChildren ? `</${direction}>` : '')\r\n    }\r\n    xml += '<border>'\r\n    xml += getBorderXml('left', left)\r\n    xml += getBorderXml('right', right)\r\n    xml += getBorderXml('top', top)\r\n    xml += getBorderXml('bottom', bottom)\r\n    xml += '<diagonal/>'\r\n    xml += '</border>'\r\n  }\r\n  xml += '</borders>'\r\n\r\n  // What are `<cellXfs/>` and `<cellStyleXfs/>`:\r\n  // http://officeopenxml.com/SSstyles.php\r\n  //\r\n  // `<cellStyleXfs/>` are referenced from `<cellXfs/>` as `<xf xfId=\"...\"/>`.\r\n  // `<cellStyleXfs/>` defines abstract \"cell styles\" that can be \"extended\"\r\n  // by \"cell styles\" defined by `<cellXfs/>` that can be applied to individual cells:\r\n  // 1. `<cellStyleXfs><xf .../></cellStyleXfs>`\r\n  // 2. `<cellXfs><xf xfId={cellStyleXfs.xf.index}/></cellXfs>`\r\n  // 3. `<c s={cellXfs.xf.index}/>`\r\n  // Seems like \"cell styles\" defined by `<cellXfs/>` have to reference\r\n  // some abstract \"cell styles\" defined by `<cellStyleXfs/>` by the spec.\r\n  // Otherwise, there would be no need to use `<cellStyleXfs/>` at all.\r\n  // The naming is ambiguous and weird. The whole scheme is needlessly redundant.\r\n\r\n  // xml += '<cellStyleXfs count=\"2\">'\r\n  // xml += '<xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\"/>'\r\n  // // `applyFont=\"1\"` means apply a custom font in this \"abstract\" \"cell style\"\r\n  // // rather than using a default font.\r\n  // // Seems like by default `applyFont` is `\"0\"` meaning that,\r\n  // // unless `\"1\"` is specified, it would ignore the `fontId` attribute.\r\n  // xml += '<xf numFmtId=\"0\" fontId=\"1\" applyFont=\"1\" fillId=\"0\" borderId=\"0\"/>'\r\n  // xml += '</cellStyleXfs>'\r\n\r\n  xml += `<cellXfs count=\"${styles.length}\">`\r\n  for (const cellStyle of styles) {\r\n    const {\r\n      fontId,\r\n      fillId,\r\n      borderId,\r\n      align,\r\n      alignVertical,\r\n      wrap,\r\n      formatId\r\n    } = cellStyle\r\n    // `applyNumberFormat=\"1\"` means \"apply the `numFmtId` attribute\".\r\n    // Seems like by default `applyNumberFormat` is `\"0\"` meaning that,\r\n    // unless `\"1\"` is specified, it would ignore the `numFmtId` attribute.\r\n    xml += '<xf ' +\r\n      [\r\n        formatId !== undefined ? `numFmtId=\"${formatId}\"` : undefined,\r\n        formatId !== undefined ? 'applyNumberFormat=\"1\"' : undefined,\r\n        fontId !== undefined ? `fontId=\"${fontId}\"` : undefined,\r\n        fontId !== undefined ? 'applyFont=\"1\"' : undefined,\r\n        fillId !== undefined ? `fillId=\"${fillId}\"` : undefined,\r\n        fillId !== undefined ? 'applyFill=\"1\"' : undefined,\r\n        borderId !== undefined ? `borderId=\"${borderId}\"` : undefined,\r\n        borderId !== undefined ? 'applyBorder=\"1\"' : undefined,\r\n        align || alignVertical || wrap ? 'applyAlignment=\"1\"' : undefined,\r\n        // 'xfId=\"0\"'\r\n      ].filter(_ => _).join(' ') +\r\n    '>' +\r\n      // Possible horizontal alignment values:\r\n      //  left, center, right, fill, justify, center_across, distributed.\r\n      // Possible vertical alignment values:\r\n      //  top, vcenter, bottom, vjustify, vdistributed.\r\n      // https://xlsxwriter.readthedocs.io/format.html#set_align\r\n      (align || alignVertical || wrap\r\n        ? '<alignment' +\r\n          (align ? ` horizontal=\"${align}\"` : '') +\r\n          (alignVertical ? ` vertical=\"${alignVertical}\"` : '') +\r\n          (wrap ? ` wrapText=\"1\"` : '') +\r\n          '/>'\r\n        : ''\r\n      ) +\r\n    '</xf>'\r\n  }\r\n  xml += `</cellXfs>`\r\n\r\n  xml += '</styleSheet>'\r\n\r\n  return xml\r\n}\r\n\r\nfunction getColor(color) {\r\n  if (color[0] !== '#') {\r\n    throw new Error(`Color \"${color}\" must start with a \"#\"`)\r\n  }\r\n  return `FF${color.slice('#'.length).toUpperCase()}`\r\n}"],"file":"styles.js"}